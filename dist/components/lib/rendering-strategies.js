"use strict";

var renderingStrategies = {
  // canvas drawing strategy - performance isssues with foreign object
  canvas: {
    update: function update() {
      this.g.append("foreignObject").attr("width", this.param("width")).attr("height", this.param("height")).append("xhtml:canvas").attr("width", this.param("width")).attr("height", this.param("height")).classed(this.param("unitClass"), true);
    },

    draw: function draw(data) {
      var _this = this;

      var el = this.g.selectAll("." + this.param("unitClass")).node();
      var ctx = this.ctx = this.ctx || el.getContext("2d");

      var width = ctx.canvas.width = this.param("width");
      var height = ctx.canvas.height = this.param("height");
      // var center = height / 2;
      var color = this.color();

      var length = data.length - 2;

      var _y = function (d) {
        return _this.yScale(d);
      };
      var _x = function (i) {
        return _this.base.xScale(_this.xxScale(i));
      };

      ctx.beginPath();
      ctx.strokeStyle = color();
      ctx.fillStyle = color();
      // ctx.moveTo(0, center);

      for (var i = 0; i < length; i += 2) {
        var x = i / 2;
        var x1 = _x(i);
        var x2 = _x(i + 2);

        ctx.moveTo(x1, _y(data[i]));
        ctx.lineTo(x1, _y(data[i + 1]));
        ctx.lineTo(x2, _y(data[i + 3]));
        ctx.lineTo(x2, _y(data[i + 2]));
        ctx.lineTo(x1, _y(data[i]));
      }

      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }
  },

  svg: {
    update: function update() {
      if (this.path) {
        return;
      }
      var color = this.color();

      // console.log("update waveform");

      this.path = this.g.append("path").classed("item", true).classed(this.param("unitClass"), true).style("fill", color()).style("stroke", color()).style("shape-rendering", "crispEdges");
    },

    draw: function draw(data) {
      var _this = this;

      var d3 = this.d3;
      var _y = function (d) {
        return _this.yScale(d);
      };
      var _x = function (i) {
        return _this.base.xScale(_this.xxScale(i));
      };

      var xRange = this.base.xScale.range();
      var currentX;
      var duration = this.xxScale.domain()[1];

      this.area = d3.svg.area().defined(function (d, i) {
        currentX = _x(i);
        // console.log(data.length + " " + currentX + " " + duration + " " + xRange[0] + " " + xRange[1]);
        return currentX >= xRange[0] && currentX <= xRange[1];
      }).x(function (d, i) {
        return currentX;
      }).y0(function (d, i) {
        return i % 2 === 0 ? _y(data[i]) : _y(data[i - 1]);
      })
      // .y0((d, i) => { return 50; })
      .y1(function (d, i) {
        return i % 2 === 0 ? _y(data[i + 1]) : _y(data[i]);
      });

      var color = this.color();
      var pathStr = this.area(data);

      this.path.attr("d", pathStr);
      pathStr = undefined;
    }
  }
};

module.exports = renderingStrategies;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzNi9jb21wb25lbnRzL3NlZ21lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOztBQUViLElBQUksbUJBQW1CLEdBQUc7O0FBRXhCLFFBQU0sRUFBRTtBQUNOLFVBQU0sRUFBRSxrQkFBVztBQUNqQixVQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FDM0IsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQ2xDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUNwQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQ3BCLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUNsQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FDcEMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDN0M7O0FBRUQsUUFBSSxFQUFFLGNBQVMsSUFBSSxFQUFFOzs7QUFDbkIsVUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNoRSxVQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFckQsVUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNuRCxVQUFJLE1BQU0sR0FBRyxHQUFHLENB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QyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO09BQUUsQ0FBQyxDQUFDOztBQUV6RSxVQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDekIsVUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFOUIsVUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQzdCLGFBQU8sR0FBRyxTQUFTLENBQUM7S0FDckI7R0FDRjtDQUNGLENBQUM7O0FBRUYsTUFBTSxDQUFDLE9BQU8sR0FBRyxtQkFBbUIsQ0FBQyIsImZpbGUiOiJlczYvY29tcG9uZW50cy9zZWdtZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgcmVuZGVyaW5nU3RyYXRlZ2llcyA9IHtcbiAgLy8gY2FudmFzIGRyYXdpbmcgc3RyYXRlZ3kgLSBwZXJmb3JtYW5jZSBpc3NzdWVzIHdpdGggZm9yZWlnbiBvYmplY3RcbiAgY2FudmFzOiB7XG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZy5hcHBlbmQoJ2ZvcmVpZ25PYmplY3QnKVxuICAgICAgICAuYXR0cignd2lkdGgnLCB0aGlzLnBhcmFtKCd3aWR0aCcpKVxuICAgICAgICAuYXR0cignaGVpZ2h0JywgdGhpcy5wYXJhbSgnaGVpZ2h0JykpXG4gICAgICAgIC5hcHBlbmQoJ3hodG1sOmNhbnZhcycpXG4gICAgICAgICAgLmF0dHIoJ3dpZHRoJywgdGhpcy5wYXJhbSgnd2lkdGgnKSlcbiAgICAgICAgICAuYXR0cignaGVpZ2h0JywgdGhpcy5wYXJhbSgnaGVpZ2h0JykpXG4gICAgICAgICAgLmNsYXNzZWQodGhpcy5wYXJhbSgndW5pdENsYXNzJyksIHRydWUpO1xuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICB2YXIgZWwgPSB0aGlzLmcuc2VsZWN0QWxsKCcuJyArIHRoaXMucGFyYW0oJ3VuaXRDbGFzcycpKS5ub2RlKCk7XG4gICAgICB2YXIgY3R4ID0gdGhpcy5jdHggPSB0aGlzLmN0eCB8fCBlbC5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICB2YXIgd2lkdGggPSBjdHguY2FudmFzLndpZHRoID0gdGhpcy5wYXJhbSgnd2lkdGgnKTtcbiAgICAgIHZhciBoZWlnaHQgPSBjdHguY2FudmFzLmhlaWdodCA9IHRoaXMucGFyYW0oJ2hlaWdodCcpO1xuICAgICAgLy8gdmFyIGNlbnRlciA9IGhlaWdodCAvIDI7XG4gICAgICB2YXIgY29sb3IgPSB0aGlzLmNvbG9yKCk7XG5cbiAgICAgIHZhciBsZW5ndGggPSBkYXRhLmxlbmd0aCAtIDI7XG5cbiAgICAgIHZhciBfeSA9IChkKSA9PiB7IHJldHVybiB0aGlzLnlTY2FsZShkKTsgfTtcbiAgICAgIHZhciBfeCA9IChpKSA9PiB7IHJldHVybiB0aGlzLmJhc2UueFNjYWxlKHRoaXMueHhTY2FsZShpKSk7IH07XG5cbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yKCk7XG4gICAgICBjdHguZmlsbFN0eWxlICAgPSBjb2xvcigpO1xuICAgICAgLy8gY3R4Lm1vdmVUbygwLCBjZW50ZXIpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAyKSB7XG4gICAgICAgIHZhciB4ID0gaSAvIDI7XG4gICAgICAgIHZhciB4MSA9IF94KGkpO1xuICAgICAgICB2YXIgeDIgPSBfeChpICsgMik7XG5cbiAgICAgICAgY3R4Lm1vdmVUbyh4MSwgX3koZGF0YVtpXSkpO1xuICAgICAgICBjdHgubGluZVRvKHgxLCBfeShkYXRhW2kgKyAxXSkpO1xuICAgICAgICBjdHgubGluZVRvKHgyLCBfeShkYXRhW2kgKyAzXSkpO1xuICAgICAgICBjdHgubGluZVRvKHgyLCBfeShkYXRhW2kgKyAyXSkpO1xuICAgICAgICBjdHgubGluZVRvKHgxLCBfeShkYXRhW2ldKSk7XG4gICAgICB9XG5cbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5maWxsKCk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuICB9LFxuXG4gIHN2Zzoge1xuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5wYXRoKSB7IHJldHVybjsgfVxuICAgICAgdmFyIGNvbG9yID0gdGhpcy5jb2xvcigpO1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhcInVwZGF0ZSB3YXZlZm9ybVwiKTtcblxuICAgICAgdGhpcy5wYXRoID0gdGhpcy5nXG4gICAgICAgIC5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAuY2xhc3NlZCgnaXRlbScsIHRydWUpXG4gICAgICAgIC5jbGFzc2VkKHRoaXMucGFyYW0oJ3VuaXRDbGFzcycpLCB0cnVlKVxuICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBjb2xvcigpKVxuICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGNvbG9yKCkpXG4gICAgICAgIC5zdHlsZSgnc2hhcGUtcmVuZGVyaW5nJywgJ2NyaXNwRWRnZXMnKTtcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgdmFyIGQzID0gdGhpcy5kMztcbiAgICAgIHZhciBfeSA9IChkKSA9PiB7IHJldHVybiB0aGlzLnlTY2FsZShkKTsgfTtcbiAgICAgIHZhciBfeCA9IChpKSA9PiB7IHJldHVybiB0aGlzLmJhc2UueFNjYWxlKHRoaXMueHhTY2FsZShpKSk7IH07XG5cbiAgICAgIHZhciB4UmFuZ2UgPSB0aGlzLmJhc2UueFNjYWxlLnJhbmdlKCk7XG4gICAgICB2YXIgY3VycmVudFg7XG4gICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnh4U2NhbGUuZG9tYWluKClbMV07XG5cbiAgICAgIHRoaXMuYXJlYSA9IGQzLnN2Zy5hcmVhKClcbiAgICAgICAgLmRlZmluZWQoKGQsIGkpID0+IHtcbiAgICAgICAgICBjdXJyZW50WCA9IF94KGkpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEubGVuZ3RoICsgXCIgXCIgKyBjdXJyZW50WCArIFwiIFwiICsgZHVyYXRpb24gKyBcIiBcIiArIHhSYW5nZVswXSArIFwiIFwiICsgeFJhbmdlWzFdKTtcbiAgICAgICAgICByZXR1cm4gKGN1cnJlbnRYID49IHhSYW5nZVswXSAmJiBjdXJyZW50WCA8PSB4UmFuZ2VbMV0pO1xuICAgICAgICB9KVxuICAgICAgICAueCgoZCwgaSkgPT4geyByZXR1cm4gY3VycmVudFg7IH0pXG4gICAgICAgIC55MCgoZCwgaSkgPT4geyByZXR1cm4gaSAlIDIgPT09IDAgPyBfeShkYXRhW2ldKSA6IF95KGRhdGFbaSAtIDFdKTsgfSlcbiAgICAgICAgLy8gLnkwKChkLCBpKSA9PiB7IHJldHVybiA1MDsgfSlcbiAgICAgICAgLnkxKChkLCBpKSA9PiB7IHJldHVybiBpICUgMiA9PT0gMCA/IF95KGRhdGFbaSArIDFdKSA6IF95KGRhdGFbaV0pOyB9KTtcblxuICAgICAgdmFyIGNvbG9yID0gdGhpcy5jb2xvcigpO1xuICAgICAgdmFyIHBhdGhTdHIgPSB0aGlzLmFyZWEoZGF0YSk7XG5cbiAgICAgIHRoaXMucGF0aC5hdHRyKCdkJywgcGF0aFN0cik7XG4gICAgICBwYXRoU3RyID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSByZW5kZXJpbmdTdHJhdGVnaWVzOyJdfQ==